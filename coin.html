<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title id="page-title">Crypto Coin Details</title>
  <meta id="page-desc" name="description" content="Live cryptocurrency details, charts and price history.">
  <style>
    body {font-family: Arial, sans-serif;background:#0f172a;color:#fff;margin:0;padding:20px;}
    a {color:#60a5fa;text-decoration:none;}
    .coin-info {background:#1e293b;padding:20px;border-radius:16px;}
    h1 {font-size:2rem;margin:0;}
    .price {font-size:1.5rem;margin:10px 0;}
    #chart {width:100%;height:400px;background:#111827;margin-top:20px;border-radius:10px;}
  </style>
</head>
<body>
  <a href="index.html">â¬… Back to Tracker</a>
  <div class="coin-info" id="coin-info"></div>
  <canvas id="chart"></canvas>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const params = new URLSearchParams(window.location.search);
    const id = params.get("id");
    const currency = params.get("currency") || "inr";
    const infoDiv = document.getElementById("coin-info");

    async function loadCoin() {
      const res = await fetch(`https://api.coingecko.com/api/v3/coins/${id}?localization=false&tickers=false&market_data=true`);
      const coin = await res.json();

      // SEO updates
      document.title = `${coin.name} Price in ${currency.toUpperCase()} | Live Chart & Market Data`;
      document.getElementById("page-desc").setAttribute("content", `Track ${coin.name} price in ${currency.toUpperCase()}, live chart, 24h change, market cap, supply, and history.`);

      infoDiv.innerHTML = `
        <h1>${coin.name} (${coin.symbol.toUpperCase()})</h1>
        <div class="price">ðŸ’° ${coin.market_data.current_price[currency].toLocaleString()} ${currency.toUpperCase()}</div>
        <p>Market Cap: ${coin.market_data.market_cap[currency].toLocaleString()} ${currency.toUpperCase()}</p>
        <p>24h Change: <span style="color:${coin.market_data.price_change_percentage_24h>=0?'lime':'red'};">
          ${coin.market_data.price_change_percentage_24h.toFixed(2)}%</span></p>
        <p>Total Supply: ${coin.market_data.total_supply ? coin.market_data.total_supply.toLocaleString() : 'N/A'}</p>
      `;

      loadChart(coin.id);
    }

    async function loadChart(id) {
      const res = await fetch(`https://api.coingecko.com/api/v3/coins/${id}/market_chart?vs_currency=${currency}&days=30`);
      const data = await res.json();
      const labels = data.prices.map(p => new Date(p[0]).toLocaleDateString());
      const prices = data.prices.map(p => p[1]);

      new Chart(document.getElementById("chart"), {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: `${id.toUpperCase()} Price (30d)`,
            data: prices,
            borderColor: '#60a5fa',
            fill: false
          }]
        }
      });
    }

    loadCoin();
  </script>
</body>
</html>
